#!/bin/bash
# Unified Job Parameters - Node Diagnosis
# Purpose: Minimal benchmark with node performance diagnostics
# Compatible with: BenchFS
# Expected duration: ~5 minutes (diagnostics) + ~5 minutes (benchmark)
#
# This configuration enables pre-benchmark node diagnostics to identify
# nodes with I/O performance issues. It runs fio tests on each node
# before starting the actual benchmark.
#
# Usage:
#   ENABLE_NODE_DIAGNOSTICS=1 ./benchfs.sh params/node_diagnosis.conf
#
# The diagnostics will:
#   1. Run fio READ test (30s) on each node
#   2. Run fio WRITE test (30s) on each node
#   3. Collect NVMe SMART data
#   4. Collect iostat data
#   5. Report any anomalous nodes (WRITE/READ ratio > 5x)

# ============================================================
# Common IOR Parameters
# ============================================================

transfer_size_list=(
  4m    # 4 MiB - verified stable
)

block_size_list=(
  1g    # 1 GiB - sufficient for diagnosis
)

ppn_list=(
  1     # Single process per node
)

ior_flags_list=(
  "-w -r"  # Write then read (shared file)
)

# ============================================================
# BenchFS-specific Parameters
# ============================================================

server_ppn_list=(
  1     # 1 server per node (default)
)

benchfs_chunk_size_list=(
  4m    # 4 MiB - matches transfer size
)

# ============================================================
# CHFS-specific Parameters (for compatibility)
# ============================================================

CHFS_CHUNK_SIZE=4194304    # 4 MiB
CHFS_PROTOCOL="verbs"
CHFS_DB_SIZE="10GB"
