# BenchFS

**é«˜æ€§èƒ½åˆ†æ•£ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**

BenchFSã¯ã€Rustã§å®Ÿè£…ã•ã‚ŒãŸåˆ†æ•£ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã€io_uringã¨UCX (Unified Communication X)ã‚’æ´»ç”¨ã—ãŸé«˜æ€§èƒ½I/Oã€RDMAé€šä¿¡ã€åŒ…æ‹¬çš„ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚HPCã‚¯ãƒ©ã‚¹ã‚¿ã§ã®åˆ†æ•£ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ€§èƒ½è©•ä¾¡ã¨ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ä¸»ãªç›®çš„ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

[![Rust](https://img.shields.io/badge/rust-1.70%2B-orange.svg)](https://www.rust-lang.org/)
[![License](https://img.shields.io/badge/license-TBD-blue.svg)](LICENSE)

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

BenchFSã¯ã€[CHFS (Cached Hierarchical File System)](https://github.com/otatebe/chfs)ã‹ã‚‰ç€æƒ³ã‚’å¾—ãŸåˆ†æ•£ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã€ä»¥ä¸‹ã®ç‰¹å¾´ã‚’æŒã¡ã¾ã™ï¼š

- **é«˜æ€§èƒ½I/O**: io_uringã«ã‚ˆã‚‹éåŒæœŸãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
- **RDMAé€šä¿¡**: UCX ActiveMessageã«ã‚ˆã‚‹ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·é€šä¿¡
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«**: Consistent Hashingã«ã‚ˆã‚‹åˆ†æ•£ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- **æŸ”è»Ÿæ€§**: ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **è¦³æ¸¬å¯èƒ½æ€§**: åŒ…æ‹¬çš„ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã¨ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
- **å‹å®‰å…¨**: Rustã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ã¨ã‚¹ãƒ¬ãƒƒãƒ‰å®‰å…¨æ€§

### CHFSã¨ã®é•ã„

| è¦³ç‚¹ | BenchFS | CHFS |
|------|---------|------|
| **ç›®çš„** | ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ»æ€§èƒ½åˆ†æ | æœ¬ç•ªç’°å¢ƒHPCå‘ã‘FS |
| **è¨€èª** | Rust | C |
| **å®Ÿè¡Œãƒ¢ãƒ‡ãƒ«** | ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰/ãƒ—ãƒ­ã‚»ã‚¹ | ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ |
| **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** | ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ | 2å±¤å›ºå®šï¼ˆpmemkv + POSIXï¼‰ |
| **æœ€é©åŒ–ç›®æ¨™** | æŸ”è»Ÿæ€§ã¨è¦³æ¸¬æ€§ | ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã¨ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ |

è©³ç´°ã¯ [docs/ARCHITECTURE_COMPARISON.md](docs/ARCHITECTURE_COMPARISON.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## âœ¨ ä¸»è¦æ©Ÿèƒ½

### åˆ†æ•£ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

- **Consistent Hashing**: 150å€‹ã®ä»®æƒ³ãƒãƒ¼ãƒ‰ã«ã‚ˆã‚‹å‡ç­‰ãªè² è·åˆ†æ•£
- **ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°**: 4MBãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºï¼ˆè¨­å®šå¯èƒ½ï¼‰
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: åˆ†æ•£ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã¨LRUã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- **ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: è¨­å®šå¯èƒ½ãªãƒ¬ãƒ—ãƒªã‚«æ•°

### é«˜æ€§èƒ½I/O

- **io_uringçµ±åˆ**: ç™»éŒ²æ¸ˆã¿ãƒãƒƒãƒ•ã‚¡ã«ã‚ˆã‚‹ã‚¼ãƒ­ã‚³ãƒ”ãƒ¼I/O
- **RDMAæœ€é©åŒ–**: 32KBé–¾å€¤ã§ã®è‡ªå‹•RDMA/RPCåˆ‡ã‚Šæ›¿ãˆï¼ˆCHFSã¨åŒã˜ï¼‰
- **éåŒæœŸå‡¦ç†**: Pluvioãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªéåŒæœŸã‚¿ã‚¹ã‚¯ç®¡ç†

### RPCé€šä¿¡ã‚·ã‚¹ãƒ†ãƒ 

- **UCX ActiveMessage**: ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°
- **ã‚¼ãƒ­ã‚³ãƒ”ãƒ¼è»¢é€**: zerocopyã‚¯ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«è‡ªå‹•é¸æŠ**: Eager/Rendezvousã®è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ
- **6ç¨®é¡ã®RPCæ“ä½œ**:
  - ReadChunk / WriteChunk
  - MetadataLookup / MetadataCreateFile / MetadataCreateDir / MetadataDelete

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

- **InMemoryChunkStore**: é«˜é€Ÿãƒ¡ãƒ¢ãƒªãƒ™ãƒ¼ã‚¹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **FileChunkStore**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹æ°¸ç¶šåŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **IOUringBackend**: io_uringçµ±åˆã®é«˜æ€§èƒ½ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«è¨­è¨ˆ**: StorageBackendãƒˆãƒ¬ã‚¤ãƒˆã§æ‹¡å¼µå¯èƒ½

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BenchFS ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒ‰                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Pluvio Runtimeï¼ˆéåŒæœŸã‚¨ã‚°ã‚¼ã‚­ãƒ¥ãƒ¼ã‚¿ï¼‰              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                        â”‚                    â”‚         â”‚
â”‚           â–¼                        â–¼                    â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  RPCã‚µãƒ¼ãƒãƒ¼     â”‚  â”‚ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†   â”‚  â”‚  ãƒãƒ£ãƒ³ã‚¯ã‚¹ãƒˆã‚¢  â”‚â”‚
â”‚  â”‚  (6 streams)    â”‚  â”‚ (Consistent Hash)â”‚  â”‚  (Pluggable)    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚           â”‚                                           â”‚           â”‚
â”‚           â–¼                                           â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆio_uring + ç™»éŒ²æ¸ˆã¿ãƒãƒƒãƒ•ã‚¡ï¼‰   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å‰ææ¡ä»¶

### å¿…é ˆ

- **Rust**: 1.70ä»¥é™
- **Linux**: kernel 5.10ä»¥é™ï¼ˆio_uringã‚µãƒãƒ¼ãƒˆå¿…é ˆï¼‰
- **UCX**: 1.12ä»¥é™ï¼ˆRDMA/å…±æœ‰ãƒ¡ãƒ¢ãƒªé€šä¿¡ç”¨ï¼‰

### æ¨å¥¨

- **InfiniBand**: RDMAé€šä¿¡ç”¨ï¼ˆã¾ãŸã¯RoCEå¯¾å¿œNICï¼‰
- **NVMe SSD**: é«˜é€Ÿã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç”¨
- **CPU**: NUMAå¯¾å¿œãƒ—ãƒ­ã‚»ãƒƒã‚µ

## ğŸš€ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 1. UCXã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Ubuntu/Debian
sudo apt-get install libucx-dev

# ã¾ãŸã¯ã€ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ“ãƒ«ãƒ‰
git clone https://github.com/openucx/ucx.git
cd ucx
./autogen.sh
./configure --prefix=/usr/local
make -j$(nproc)
sudo make install
```

### 2. BenchFSã®ãƒ“ãƒ«ãƒ‰

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd benchfs

# ä¾å­˜é–¢ä¿‚ã‚’å«ã‚ã¦ãƒ“ãƒ«ãƒ‰
cargo build --release

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cargo test

# ãƒã‚§ãƒƒã‚¯
cargo check
```

## ğŸ¬ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```bash
cp benchfs.toml.example benchfs.toml
```

`benchfs.toml`ã‚’ç·¨é›†ï¼š

```toml
[node]
node_id = "node1"
data_dir = "/tmp/benchfs"
log_level = "info"

[storage]
chunk_size = 4194304        # 4MB
use_iouring = true

[network]
bind_addr = "0.0.0.0:50051"
rdma_threshold_bytes = 32768  # 32KB

[cache]
metadata_cache_entries = 1000
chunk_cache_mb = 100
```

### 2. ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
# ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
cargo run --release --bin benchfsd -- --config benchfs.toml

# ã¾ãŸã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§èµ·å‹•
cargo run --release --bin benchfsd
```

### 3. ãƒ­ã‚°ç¢ºèª

```bash
# ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
tail -f /tmp/benchfs/benchfs.log
```

## âš™ï¸ è¨­å®š

### ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã®èª¿æ•´

```toml
[storage]
# å¤§è¦æ¨¡ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«I/Oå‘ã‘ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
chunk_size = 4194304  # 4MB

# ã¾ãŸã¯ã€CHFSäº’æ›ã®å°ãƒ•ã‚¡ã‚¤ãƒ«å‘ã‘
chunk_size = 65536    # 64KB
```

### RDMAé–¾å€¤ã®èª¿æ•´

```toml
[network]
# 32KBä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿è»¢é€ã§RDMAä½¿ç”¨ï¼ˆCHFSã¨åŒã˜ï¼‰
rdma_threshold_bytes = 32768

# ã‚ˆã‚Šå¤§ããªãƒ‡ãƒ¼ã‚¿ã§RDMAä½¿ç”¨
rdma_threshold_bytes = 131072  # 128KB
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š

```toml
[cache]
# ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ãƒˆãƒªæ•°
metadata_cache_entries = 1000

# ãƒãƒ£ãƒ³ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºï¼ˆMBï¼‰
chunk_cache_mb = 100

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTLï¼ˆç§’ã€0=ç„¡æœŸé™ï¼‰
cache_ttl_secs = 0
```

è©³ç´°ã¯ `benchfs.toml.example` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“– ä½¿ç”¨ä¾‹

### Rust APIã®ä½¿ç”¨

```rust
use benchfs::api::{BenchFS, OpenFlags, ApiError};
use benchfs::config::ServerConfig;

#[pluvio_runtime::main]
async fn main() -> Result<(), ApiError> {
    // è¨­å®šã‚’èª­ã¿è¾¼ã¿
    let config = ServerConfig::from_file("benchfs.toml")?;

    // BenchFSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
    let fs = BenchFS::new(config).await?;

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    let fd = fs.create("/test.txt", OpenFlags::CREATE | OpenFlags::WRITE).await?;

    // ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã¿
    let data = b"Hello, BenchFS!";
    let written = fs.write(fd, data).await?;
    println!("Wrote {} bytes", written);

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã‚‹
    fs.close(fd).await?;

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Š
    let fd = fs.open("/test.txt", OpenFlags::READ).await?;
    let mut buffer = vec![0u8; 1024];
    let read = fs.read(fd, &mut buffer).await?;
    println!("Read {} bytes: {:?}", read, &buffer[..read]);

    fs.close(fd).await?;

    Ok(())
}
```

### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ

```rust
use benchfs::metadata::{MetadataManager, FileMetadata};

// ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½œæˆ
let manager = MetadataManager::new(cache_policy);
manager.add_node("node1".to_string());

// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
let metadata = FileMetadata::new(1, "/data/file.txt".to_string(), 1024);
manager.store_file_metadata(metadata).await?;

// ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
let retrieved = manager.get_file_metadata("/data/file.txt").await?;
println!("File size: {} bytes", retrieved.size);
```

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ä½¿ç”¨

```rust
use benchfs::storage::{InMemoryChunkStore, ChunkStore};

// ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚¢ã‚’ä½œæˆ
let mut store = InMemoryChunkStore::new(1024 * 1024 * 100); // 100MB

// ãƒãƒ£ãƒ³ã‚¯ã‚’æ›¸ãè¾¼ã¿
let data = vec![42u8; 4096];
store.write_chunk(1, 0, 0, &data).await?;

// ãƒãƒ£ãƒ³ã‚¯ã‚’èª­ã¿å–ã‚Š
let read_data = store.read_chunk(1, 0, 0, 4096).await?;
assert_eq!(data, read_data);
```

## ğŸ”§ é–‹ç™ºã‚¬ã‚¤ãƒ‰

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
benchfs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/              # ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘API
â”‚   â”œâ”€â”€ rpc/              # RPCé€šä¿¡ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ metadata/         # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
â”‚   â”œâ”€â”€ storage/          # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ data/             # ãƒ‡ãƒ¼ã‚¿åˆ†æ•£ãƒ»ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°
â”‚   â”œâ”€â”€ cache/            # ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°å±¤
â”‚   â”œâ”€â”€ config.rs         # è¨­å®šç®¡ç†
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ benchfsd.rs   # ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ãƒ¢ãƒ³
â”œâ”€â”€ docs/                 # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ARCHITECTURE_COMPARISON.md
â”‚   â””â”€â”€ IMPLEMENTATION_CHANGELOG.md
â”œâ”€â”€ benchfs.toml.example  # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹
â””â”€â”€ README.md             # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
cargo test

# ç‰¹å®šã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ
cargo test metadata::

# çµ±åˆãƒ†ã‚¹ãƒˆ
cargo test --test integration_tests

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆï¼ˆtarpaulinå¿…é ˆï¼‰
cargo tarpaulin --out Html
```

### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®å®Ÿè¡Œ

```bash
# ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œ
cargo bench

# ç‰¹å®šã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
cargo bench --bench file_ops_bench
```

### ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨Lint

```bash
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
cargo fmt

# Lint
cargo clippy -- -D warnings

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
cargo doc --no-deps --open
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ç›®æ¨™ï¼ˆCHFSãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼‰

| æ“ä½œ | ç›®æ¨™ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· |
|------|----------------|
| å°èª­ã¿å–ã‚Šï¼ˆ< 32 KBï¼‰ | < 1 ms |
| å¤§èª­ã¿å–ã‚Šï¼ˆ> 32 KBã€RDMAï¼‰ | < 100 Î¼s |
| å°æ›¸ãè¾¼ã¿ï¼ˆ< 32 KBï¼‰ | < 1 ms |
| å¤§æ›¸ãè¾¼ã¿ï¼ˆ> 32 KBã€RDMAï¼‰ | < 1 ms |
| ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ | < 10 ms |

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ç›®æ¨™

- **ãƒãƒ¼ãƒ‰æ•°**: 1024ãƒãƒ¼ãƒ‰ä»¥ä¸Šå¯¾å¿œ
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—**: O(log n)
- **Consistent Hashing**: 150ä»®æƒ³ãƒãƒ¼ãƒ‰/ç‰©ç†ãƒãƒ¼ãƒ‰
- **è² è·åˆ†æ•£**: å„ãƒãƒ¼ãƒ‰ãŒå‡ç­‰ã«ã‚­ãƒ¼ã‚’æ‹…å½“

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯”è¼ƒ](docs/ARCHITECTURE_COMPARISON.md)**: BenchFS vs CHFS ã®è©³ç´°æ¯”è¼ƒï¼ˆæ—¥æœ¬èªï¼‰
- **[å®Ÿè£…å¤‰æ›´ãƒ­ã‚°](docs/IMPLEMENTATION_CHANGELOG.md)**: æœ€æ–°ã®å®Ÿè£…å¤‰æ›´å†…å®¹

### è¨­è¨ˆãƒãƒ¼ãƒˆ

- **[CHFSå®Ÿè£…è¨ˆç”»](claude_log/001_benchfs_implementation_plan.md)**: å½“åˆã®å®Ÿè£…è¨ˆç”»
- **[CHFSè©³ç´°åˆ†æ](claude_log/022_CHFS_architecture_analysis.md)**: CHFSã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è©³ç´°ï¼ˆè‹±èªï¼‰
- **[CHFSæ¯”è¼ƒåˆ†æ](claude_log/023_CHFS_BENCHFS_COMPARISON.md)**: æ¯”è¼ƒåˆ†æï¼ˆè‹±èªï¼‰

### API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

```bash
# APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦é–‹ã
cargo doc --no-deps --open
```

## ğŸ›£ï¸ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### å®Ÿè£…æ¸ˆã¿ âœ“

- [x] RPCé€šä¿¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆUCX ActiveMessageï¼‰
- [x] Consistent Hashingãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- [x] ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- [x] io_uringçµ±åˆ
- [x] ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ï¼ˆLRUï¼‰
- [x] ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°ã¨ãƒ‡ãƒ¼ã‚¿åˆ†æ•£
- [x] RDMAé–¾å€¤è¨­å®š

### çŸ­æœŸï¼ˆ1-2é€±é–“ï¼‰

- [ ] RDMAé–¾å€¤ã«ã‚ˆã‚‹è‡ªå‹•RPC/RDMAåˆ‡ã‚Šæ›¿ãˆå®Ÿè£…
- [ ] ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºé•ã„ã§ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] è¨­å®šãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å……å®Ÿ

### ä¸­æœŸï¼ˆ1-2ãƒ¶æœˆï¼‰

- [ ] 2å±¤ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆInMemory + Fileè‡ªå‹•éšå±¤åŒ–ï¼‰
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°
- [ ] ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTLå®Œå…¨å®Ÿè£…
- [ ] FUSEçµ±åˆï¼ˆchfuseç›¸å½“ï¼‰

### é•·æœŸï¼ˆ2-3ãƒ¶æœˆï¼‰

- [ ] I/Oèªè­˜å‹ãƒ•ãƒ©ãƒƒã‚·ãƒ³ã‚°æ©Ÿæ§‹
- [ ] ãƒªãƒ³ã‚°é¸æŠã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒˆãƒˆãƒ¬ãƒ©ãƒ³ã‚¹ï¼‰
- [ ] ãƒãƒ¼ãƒ‰å‚åŠ /é›¢è„±ãƒ—ãƒ­ãƒˆã‚³ãƒ«
- [ ] CHFS vs BenchFS åŒ…æ‹¬çš„ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

## ğŸ¤ è²¢çŒ®

è²¢çŒ®ã‚’æ­“è¿ã—ã¾ã™ï¼ä»¥ä¸‹ã®æ‰‹é †ã§è²¢çŒ®ã—ã¦ãã ã•ã„ï¼š

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆï¼ˆ`git checkout -b feature/amazing-feature`ï¼‰
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆï¼ˆ`git commit -m 'Add amazing feature'`ï¼‰
4. ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆ`git push origin feature/amazing-feature`ï¼‰
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- Rustã®æ¨™æº–ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ`cargo fmt`ï¼‰ã«å¾“ã†
- `cargo clippy`ã®è­¦å‘Šã‚’ã™ã¹ã¦è§£æ±º
- æ–°æ©Ÿèƒ½ã«ã¯å¿…ãšãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
- ãƒ‘ãƒ–ãƒªãƒƒã‚¯APIã«ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

TBD

## ğŸ™ è¬è¾

- **[CHFS](https://github.com/otatebe/chfs)**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¤šãã‚’å‚è€ƒã«ã—ã¾ã—ãŸ
- **UCXãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: é«˜æ€§èƒ½é€šä¿¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **io_uringã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£**: é«˜æ€§èƒ½éåŒæœŸI/Oã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **Rustã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£**: ç´ æ™´ã‚‰ã—ã„ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¨ãƒ„ãƒ¼ãƒ«

## ğŸ“§ ãŠå•ã„åˆã‚ã›

è³ªå•ã‚„ææ¡ˆãŒã‚ã‚‹å ´åˆã¯ã€Issueã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

---

**Note**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯é–‹ç™ºä¸­ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨ã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“ã€‚ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨ç ”ç©¶ç›®çš„ã§ã®ä½¿ç”¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
